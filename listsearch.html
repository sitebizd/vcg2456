<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Directory</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f5f5f5; }
        h2 { text-align: center; }
        .search-container {
            margin-bottom: 15px;
            text-align: center;
        }
        #searchInput {
            width: 80%;
            padding: 10px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .business-card {
            background: #fff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
        }
        .business-img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }
        .business-details {
            flex: 1;
        }
        .business-name {
            font-size: 22px;
            font-weight: bold;
        }
        .business-description {
            color: #666;
        }
        .call-btn {
            background-color: #28a745;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
        }
        .no-result {
            text-align: center;
            color: #888;
            font-size: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h2>üìá Business Directory</h2>

<div class="search-container">
    <input 
        type="text" 
        id="searchInput" 
        placeholder="üîç Search by name, description, or address..." 
        onkeyup="filterList()"
    >
</div>

<div id="businessList"></div>

<script>
    let businessData = [];

    // Fetch CSV Data from Google Sheets
    async function fetchCSV() {
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/1hJeRy7iYhtI8QBwfXv9YvuXXCCMafDrj17b55UHFCfQ/pub?output=csv'; 
        try {
            const response = await fetch(sheetUrl);
            const text = await response.text();
            businessData = parseCSV(text);
            renderList(businessData);
        } catch (error) {
            console.error("Error fetching CSV:", error);
        }
    }

    // Parse CSV Text into Objects
    function parseCSV(text) {
        const rows = text.split("\n").map(row => row.split(","));
        rows.shift(); // Remove header row

        return rows.map(columns => ({
            profileID: columns[0],                       // Column A
            personName: columns[1],                      // Column B
            businessName: columns[2],                    // Column C
            businessNameEnglish: columns[3],             // Column D
            businessDescription: columns[4],             // Column E
            businessAddress: columns[5],                 // Column F
            marketArea: columns[6],                      // Column G
            paymentStatus: columns[7],                   // Column H
            verifiedBadges: columns[8],                  // Column I
            category1: columns[9],                       // Column J
            category2: columns[10],                      // Column K
            mobileNumber: columns[11],                   // Column L
            whatsappNumber: columns[12],                 // Column M
            website: columns[13],                        // Column N
            facebookPage: columns[14],                   // Column O
            youtubeChannel: columns[15],                 // Column P
            instagram: columns[16],                      // Column Q
            googleMap: columns[17],                      // Column R
            image1: columns[18] || 'default.jpg',        // Column S
        }));
    }

    // Render Business List
    function renderList(data) {
        const listContainer = document.getElementById("businessList");
        listContainer.innerHTML = "";

        if (data.length === 0) {
            listContainer.innerHTML = `<div class="no-result">üö´ No results found.</div>`;
            return;
        }

        data.forEach(business => {
            const card = document.createElement("div");
            card.className = "business-card";
            card.innerHTML = `
                <img src="${business.image1}" class="business-img" alt="Business Image">
                <div class="business-details">
                    <h3 class="business-name">${business.businessName}</h3>
                    <p><strong>üë§ ${business.personName}</strong></p>
                    <p class="business-description">${business.businessDescription}</p>
                    <p><strong>üìç ${business.businessAddress}</strong></p>
                    <a href="tel:${business.mobileNumber}" class="call-btn">üìû Call</a>
                </div>
            `;
            listContainer.appendChild(card);
        });
    }

    // Search Function
    function filterList() {
        const searchInput = document.getElementById("searchInput").value.toLowerCase();
        const filteredData = businessData.filter(business =>
            business.personName.toLowerCase().includes(searchInput) ||
            business.businessName.toLowerCase().includes(searchInput) ||
            business.businessNameEnglish.toLowerCase().includes(searchInput) ||
            business.businessDescription.toLowerCase().includes(searchInput) ||
            business.businessAddress.toLowerCase().includes(searchInput)
        );
        renderList(filteredData);
    }

    // Fetch Data on Page Load
    fetchCSV();
</script>

</body>
</html>
