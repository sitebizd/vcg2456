<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OCR to MCQ Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #2c3e50;
    }
    input[type="file"], button, select {
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background: #3498db;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #2980b9;
    }
    #extractedText {
      white-space: pre-wrap;
      margin: 20px auto;
      background: #fff;
      padding: 15px;
      width: 80%;
      border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
      text-align: left;
    }
    .question {
      background: #ffffff;
      border-radius: 10px;
      padding: 15px;
      margin: 10px auto;
      width: 80%;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: left;
    }
    .question h3 {
      margin-bottom: 10px;
    }
    .options label {
      display: block;
      margin-bottom: 8px;
    }
    .correct {
      color: green;
    }
    .wrong {
      color: red;
    }
    .score {
      font-size: 20px;
      margin-top: 20px;
      font-weight: bold;
    }
    .tick::after {
      content: "âœ”";
      color: green;
      margin-left: 5px;
    }
    .cross::after {
      content: "âœ˜";
      color: red;
      margin-left: 5px;
    }
  </style>
</head>
<body>

<h1>ðŸ§  OCR to MCQ Generator</h1>

<input type="file" id="imageInput" accept="image/*">
<button onclick="extractText()">Extract Text</button>
<br>
<textarea id="extractedText" rows="10" style="display:none;"></textarea>
<br>
<label for="numQuestions">Number of Questions:</label>
<select id="numQuestions">
  <option>5</option>
  <option>10</option>
  <option>15</option>
  <option>20</option>
</select>
<button onclick="generateMCQ()">Generate MCQ</button>

<div id="quizContainer"></div>
<button id="submitBtn" onclick="submitQuiz()" style="display:none;">Submit</button>
<div id="resultContainer"></div>
<button onclick="location.reload()" style="display:none;" id="newTestBtn">New Test</button>

<script>
  let extracted = "";
  let quizData = [];

  async function extractText() {
    const image = document.getElementById('imageInput').files[0];
    if (!image) return alert("Please upload an image.");

    const { data: { text } } = await Tesseract.recognize(image, 'eng', {
      logger: m => console.log(m)
    });
    extracted = text.trim();
    const textarea = document.getElementById('extractedText');
    textarea.value = extracted;
    textarea.style.display = 'block';
  }

  async function generateMCQ() {
    if (!extracted) return alert("No text to generate MCQs from!");

    const num = document.getElementById('numQuestions').value;

    const prompt = `
Extract ${num} multiple-choice questions from the following text. Each question should have four distinct options (A, B, C, D) and the correct answer marked. Provide output in JSON format like:
[
  {
    "question": "Sample?",
    "options": ["A", "B", "C", "D"],
    "answer": "B"
  }
]
TEXT:
"""${extracted}"""
`;

    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "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" // Replace this with your actual key
      },
      body: JSON.stringify({
        model: "gpt-4",
        messages: [
          { role: "system", content: "You are a helpful assistant that creates MCQs from educational text." },
          { role: "user", content: prompt }
        ],
        temperature: 0.7
      })
    });

    const data = await response.json();
    try {
      quizData = JSON.parse(data.choices[0].message.content);
      showQuiz();
    } catch (e) {
      alert("Error parsing MCQs. Please try again.");
      console.error("AI Output:", data.choices[0].message.content);
    }
  }

  function showQuiz() {
    const container = document.getElementById('quizContainer');
    container.innerHTML = "";
    quizData.forEach((q, i) => {
      const qDiv = document.createElement('div');
      qDiv.className = 'question';
      qDiv.innerHTML = `<h3>${i + 1}. ${q.question}</h3>`;
      const opts = document.createElement('div');
      opts.className = 'options';
      q.options.forEach((opt, j) => {
        const id = `q${i}_opt${j}`;
        opts.innerHTML += `
          <label><input type="radio" name="q${i}" value="${opt}" id="${id}"> ${opt}</label>
        `;
      });
      qDiv.appendChild(opts);
      container.appendChild(qDiv);
    });
    document.getElementById('submitBtn').style.display = 'inline-block';
  }

  function submitQuiz() {
    let score = 0;
    const result = document.getElementById('resultContainer');
    result.innerHTML = "<h2>Result:</h2>";
    quizData.forEach((q, i) => {
      const selected = document.querySelector(`input[name="q${i}"]:checked`);
      const userAnswer = selected ? selected.value : "Not Answered";
      const isCorrect = userAnswer === q.answer;
      if (isCorrect) score++;
      const resDiv = document.createElement('div');
      resDiv.className = 'question';
      resDiv.innerHTML = `
        <h3>${i + 1}. ${q.question}</h3>
        <p>Your Answer: <span class="${isCorrect ? 'tick' : 'cross'}">${userAnswer}</span></p>
        <p>Correct Answer: <strong class="correct">${q.answer}</strong></p>
      `;
      result.appendChild(resDiv);
    });
    result.innerHTML = `<div class="score">Score: ${score} / ${quizData.length}</div>` + result.innerHTML;
    document.getElementById('submitBtn').style.display = 'none';
    document.getElementById('newTestBtn').style.display = 'inline-block';
  }
</script>

</body>
</html>
