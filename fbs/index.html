<!DOCTYPE html>
<html>
<head>
    <title>Firebase Image Upload</title>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-storage.js"></script>
</head>
<body>
    <select id="folderSelect">
        <!-- Options will be dynamically populated -->
		<option>Folder 1</option>
		<option>Folder 2</option>
    </select>
	
    <input type="file" id="imageUpload">
    <button id="uploadButton">Upload Image</button>
    <progress value="0" max="100" id="uploader">0%</progress>
    <img id="imagePreview" width="200px">
    <button id="copyUrlButton">Copy Image URL</button>

    <script>
        // Initialize Firebase
        var config = {
            apiKey: process.env.API_KEY,
            authDomain: process.env.AUTH_DOMAIN,
            projectId: process.env.PROJECT_ID,
            storageBucket: process.env.STORAGE_BUCKET,
            messagingSenderId: process.env.MESSAGING_SENDER_ID,
            appId: process.env.APP_ID
        };
        firebase.initializeApp(config);

        // Get elements
        var uploader = document.getElementById('uploader');
        var imageUpload = document.getElementById('imageUpload');
        var uploadButton = document.getElementById('uploadButton');
        var imagePreview = document.getElementById('imagePreview');
        var copyUrlButton = document.getElementById('copyUrlButton');
        var folderSelect = document.getElementById('folderSelect');

        // Listen for file selection
        imageUpload.addEventListener('change', function(e) {
            // Get file
            var file = e.target.files[0];

            // Create a storage ref
            var storageRef = firebase.storage().ref(folderSelect.value + '/' + file.name);

            // Upload file
            var task = storageRef.put(file);

            // Update progress bar
            task.on('state_changed',
                function progress(snapshot) {
                    var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    uploader.value = percentage;
                },
                function error(err) {
                    console.log(err);
                },
                function complete() {
                    task.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                        console.log('File available at', downloadURL);
                        imagePreview.src = downloadURL;
                        copyUrlButton.onclick = function() {
                            navigator.clipboard.writeText(downloadURL);
                        };
                    });
                }
            );
        });
    </script>
</body>
</html>
